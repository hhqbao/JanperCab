<div class="duraform-order-step-three">
  <app-float-box *ngIf="showCustomerSelector" [width]="150">
    <div style="padding: 2rem; background-color: white">
      <div class="row" style="margin-bottom: 1.5rem">
        <div class="col-1-2">
          <h1
            class="heading heading--default"
            style="padding-bottom: 0; border-bottom: none"
          >
            Select Customer
          </h1>
        </div>
        <div class="col-1-2 text-right">
          <button
            type="button"
            class="btn btn--default"
            (click)="showCustomerSelector = false"
          >
            Close
          </button>
        </div>
      </div>
      <app-cabinet-maker-list
        [allowAdd]="false"
        (itemClick)="onSelectCabinetMaker($event)"
      ></app-cabinet-maker-list>
    </div>
  </app-float-box>
  <app-float-box *ngIf="showInvoiceForm">
    <app-invoice-detail-form
      (update)="onUpdateInvoiceDetails($event)"
      (cancel)="showInvoiceForm = false"
    ></app-invoice-detail-form>
  </app-float-box>
  <app-float-box *ngIf="showDeliveryForm">
    <app-delivery-detail-form
      (update)="onUpdateDeliveryDetails($event)"
      (cancel)="showDeliveryForm = false"
    ></app-delivery-detail-form>
  </app-float-box>
  <app-pdf-viewer
    *ngIf="showDeliveryDocket"
    (closePanel)="showDeliveryDocket = false"
  >
    <app-delivery-docket [data]="deliveryDocketData"></app-delivery-docket>
  </app-pdf-viewer>
  <div class="component-box">
    <div class="shipping-details-box">
      <button
        type="button"
        class="btn btn--primary"
        *ngIf="
          !order.duraformId &&
          auth.customer.customerType === customerType.Distributor
        "
        (click)="showCustomerSelector = true"
        style="margin-bottom: 2rem"
      >
        <span>{{ cabinetMaker ? "Change" : "Select" }}</span> Customer
      </button>
      <h1 class="customer-name" *ngIf="order.duraformId || cabinetMaker">
        {{ cabinetMaker?.name }}
      </h1>
      <div class="row" *ngIf="order.cabinetMakerId">
        <div class="col-1-2">
          <div class="row">
            <div class="col-1-2">
              <div class="detail">
                <button
                  type="button"
                  class="detail__edit-btn"
                  *ngIf="order.isEditable"
                  (click)="showInvoiceForm = true"
                >
                  <i class="fa fa-pencil-square-o" aria-hidden="true"></i>
                </button>
                <div class="detail__title">Invoice To</div>
                <div class="detail__body">
                  <div class="detail__name">{{ order.invoiceTo }}</div>
                  <div class="detail__address-main">
                    {{ order.invoiceAddress }}
                  </div>
                  <div class="detail__address-sub">
                    {{ order.invoiceSuburb }}, {{ order.invoiceState }}
                    {{ order.invoicePostcode }}
                  </div>
                </div>
              </div>
            </div>
            <div class="col-1-2">
              <div class="detail">
                <button
                  type="button"
                  class="detail__edit-btn"
                  *ngIf="order.isEditable"
                  (click)="showDeliveryForm = true"
                >
                  <i class="fa fa-pencil-square-o" aria-hidden="true"></i>
                </button>
                <div class="detail__title">Delivery To</div>
                <div class="detail__body">
                  <div class="detail__name">{{ order.deliveryTo }}</div>
                  <div class="detail__address-main">
                    {{ order.deliveryAddress }}
                  </div>
                  <div class="detail__address-sub">
                    {{ order.deliverySuburb }}, {{ order.deliveryState }}
                    {{ order.deliveryPostcode }}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-1-2">
          <app-simple-box [heading]="'Delivery Note'">
            <textarea
              class="form__control"
              style="font-size: 1.8rem"
              [disabled]="!order.isEditable"
              [(ngModel)]="order.deliveryNote"
            ></textarea>
          </app-simple-box>
        </div>
      </div>
    </div>
    <div *ngIf="order.cabinetMakerId">
      <div class="row">
        <div class="col-2-3">
          <ul class="selection-list">
            <li class="selection">
              <span class="selection__door-design">
                {{ order.selectedDesign.name }}
              </span>
            </li>
            <li class="selection" *ngIf="order.isRoutingOnly">
              <div class="selection__route-only">ROUTE ONLY</div>
            </li>
            <li class="selection" *ngIf="!order.isRoutingOnly">
              <span class="selection__wrap-type">
                {{ order.selectedWrapType?.name }}
              </span>
              <span class="selection__wrap-color">
                {{ order.selectedWrapColor?.name }}
              </span>
            </li>
            <li class="selection">
              <span class="selection__door-serie">
                {{ order.selectedSerie.name }}
              </span>
            </li>
            <li class="selection" *ngIf="order.hingeHoleTypeId">
              <span class="selection__hinge-hole"> HINGE HOLE </span>
            </li>
          </ul>
        </div>
        <div class="col-1-3 middle">
          <div class="row" style="width: 100%">
            <div class="col-1-3 middle"></div>
          </div>
        </div>
      </div>

      <table
        class="table table--component-list"
        style="max-width: 50rem; margin: 3rem 0"
      >
        <thead>
          <tr>
            <th style="width: 20rem">Option & Accessories</th>
            <th>Description</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngIf="order.hingeHoleTypeId">
            <td class="text-left">
              {{ asset.getHingeType(order.hingeHoleTypeId).name }}
            </td>
            <td>({{ order.componentsWithHingeHoleCount }}) Hinge Holes</td>
          </tr>
          <tr>
            <td class="text-left">Edge Profile</td>
            <td>
              {{ order.selectedEdgeProfile?.name }}
            </td>
          </tr>
          <tr>
            <td class="text-left">Arch Profile</td>
            <td>
              {{ order.selectedArch ? order.selectedArch.name : "SQUARE" }}
            </td>
          </tr>
        </tbody>
      </table>

      <div
        class="component-list"
        *ngIf="
          order.duraformFiles.length > 0 || fileService.duraformFiles.length > 0
        "
      >
        <div class="panel" style="display: inline-block; width: 100rem">
          <div class="panel__heading">Files</div>
          <div class="panel__content">
            <table class="table table--hovered">
              <tbody *ngIf="order.duraformFiles.length > 0">
                <tr *ngFor="let file of order.duraformFiles">
                  <td class="text-center" style="width: 3rem">
                    <i
                      *ngIf="file.fileType.includes('image')"
                      class="fa fa-file-image-o"
                      aria-hidden="true"
                    ></i>
                    <i
                      *ngIf="file.fileType.includes('pdf')"
                      class="fa fa-file-pdf-o"
                      aria-hidden="true"
                    ></i>
                  </td>
                  <td class="text-left" style="width: 20rem">
                    {{ file.fileName }}
                  </td>
                  <td class="text-left">
                    {{ file.description }}
                  </td>
                  <td style="width: 15rem">
                    <span class="text-green">Uploaded</span>
                  </td>
                  <td class="text-center" style="width: 10rem">
                    {{ file.fileSize | fileSize }}
                  </td>
                  <td class="text-center" style="width: 5rem">
                    <button
                      type="button"
                      class="btn btn--link"
                      (click)="onViewUploadedFile(file.id)"
                    >
                      View
                    </button>
                  </td>
                </tr>
              </tbody>
              <tbody *ngIf="fileService.duraformFiles.length > 0">
                <tr *ngFor="let file of fileService.duraformFiles">
                  <td class="text-center" style="width: 3rem">
                    <i
                      *ngIf="file.fileType.includes('image')"
                      class="fa fa-file-image-o"
                      aria-hidden="true"
                    ></i>
                    <i
                      *ngIf="file.fileType.includes('pdf')"
                      class="fa fa-file-pdf-o"
                      aria-hidden="true"
                    ></i>
                  </td>
                  <td class="text-left" style="width: 20rem">
                    {{ file.fileName }}
                  </td>
                  <td class="text-left">
                    {{ file.description }}
                  </td>
                  <td style="width: 15rem">
                    <span class="text-alert">Not Uploaded</span>
                  </td>
                  <td class="text-center" style="width: 10rem">
                    {{ file.fileSize | fileSize }}
                  </td>
                  <td class="text-center" style="width: 5rem">
                    <button
                      type="button"
                      class="btn btn--link"
                      (click)="onViewNotUploadedFile(file)"
                    >
                      View
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <app-box
        [showHeading]="false"
        [isScrollable]="true"
        [isTransparent]="true"
      >
        <div class="component-list" *ngIf="order.duraformDoors.length > 0">
          <app-duraform-door-component-list
            [duraformDoors]="order.duraformDoors"
          ></app-duraform-door-component-list>
        </div>
        <div class="component-list" *ngIf="order.pantryDoors.length > 0">
          <app-duraform-pantry-door-component-list
            [pantryDoors]="order.pantryDoors"
          ></app-duraform-pantry-door-component-list>
        </div>
        <div class="component-list" *ngIf="order.endPanels.length > 0">
          <app-end-panel-component-list
            [endPanels]="order.endPanels"
          ></app-end-panel-component-list>
        </div>
        <div class="component-list" *ngIf="order.duraformDrawers.length > 0">
          <app-duraform-drawer-component-list
            [duraformDrawers]="order.duraformDrawers"
          ></app-duraform-drawer-component-list>
        </div>
      </app-box>
    </div>
  </div>
  <div class="option-box" *ngIf="order.cabinetMakerId">
    <div style="margin-bottom: 1rem" *ngIf="order.duraformId">
      <app-simple-box [heading]="'Status'">
        <div class="option-box__status" *ngIf="order.isDraft">Draft</div>
        <div class="option-box__status" *ngIf="order.isOrder">
          <span *ngIf="order.orderStatus === orderStatus.Submitted">
            Submitted
          </span>
          <span *ngIf="order.orderStatus === orderStatus.DistributorDeclined">
            Declined
          </span>
          <span *ngIf="order.orderStatus === orderStatus.DistributorApproved">
            Approved
          </span>
        </div>
      </app-simple-box>
    </div>
    <app-simple-box [heading]="'Customer Order Number'">
      <input
        type="text"
        class="form__control text-center"
        style="font-weight: bold; font-size: 2rem; padding: 1rem"
        required
        [disabled]="!order.isEditable"
        [(ngModel)]="order.customerOrderNumber"
      />
    </app-simple-box>
    <div style="margin-top: 1rem">
      <div class="option-box__action-center" *ngIf="!order.isOrder">
        <button
          class="action-btn"
          *ngIf="order.isDraft"
          [disabled]="!order.customerOrderNumber"
          (click)="onSaveDraft()"
        >
          <i class="fa fa-file-text text-brown"></i>
          <span>
            {{ !order.duraformId ? "Save as Draft" : "Update Draft" }}
          </span>
        </button>
        <button
          class="action-btn"
          *ngIf="order.isDraft"
          [disabled]="!order.customerOrderNumber"
          (click)="onSendInQuote()"
        >
          <i class="fa fa-quora text-blue" aria-hidden="true"></i>
          <span>
            {{ !order.duraformId ? "Send in Quote" : "Convert to Quote" }}
          </span>
        </button>
        <button
          class="action-btn"
          [disabled]="!order.customerOrderNumber"
          (click)="onSendInOrder()"
        >
          <i class="fa fa-plug text-orange"></i>
          <span>
            {{ !order.duraformId ? "Send in Order" : "Convert to Order" }}
          </span>
        </button>
      </div>
      <div
        class="option-box__action-center"
        *ngIf="
          auth.isInRole(role[role.Distributor]) &&
          order.isOrder &&
          order.orderStatus === orderStatus.Submitted
        "
      >
        <button class="action-btn" (click)="onApproveOrder()">
          <i class="fa fa-check text-green" aria-hidden="true"></i>
          <span>Approve Order</span>
        </button>
        <button class="action-btn" (click)="onDeclineOrder()">
          <i class="fa fa-ban text-alert" aria-hidden="true"></i>
          <span>Declide Order</span>
        </button>
      </div>
      <div
        class="option-box__action-center"
        *ngIf="auth.isInRole(role[role.Manufacturer])"
      >
        <button
          class="action-btn"
          [disabled]="!order.customerOrderNumber"
          (click)="onViewDeliveryDocket()"
        >
          <i class="fa fa-truck" aria-hidden="true"></i>
          <span>View Delivery Docket</span>
        </button>
        <button
          class="action-btn"
          *ngIf="order.isOrder"
          (click)="onExportCapProExcel()"
        >
          <i class="fa fa-database text-green" aria-hidden="true"></i>
          <span>Export For CabPro</span>
        </button>
      </div>
      <div class="option-box__action-center" *ngIf="order.isEditable">
        <button class="action-btn" (click)="onEditClick()">
          <i class="fa fa-pencil"></i>
          <span>Go Back & Edit</span>
        </button>
      </div>
    </div>
  </div>
</div>
